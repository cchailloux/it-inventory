<!DOCTYPE html>
<html lang="en">

</html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Devices Inventory</title>
    <style>
        th {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Manage all company's devices</h1>
    <h2>Add a device</h2>
    <!-- Question: should all of the info be required ? -->
    <!-- type="numeric" is better for mobile than "number" (+ no spinners)-->
    <form id="addDeviceForm">
        <label for="computerName">Computer Name:</label>
        <input type="text" id="computerName" name="computerName" required><br>
        <label for="dateOfPurchase">Date of Purchase:</label>
        <input type="date" id="dateOfPurchase" name="dateOfPurchase" required><br>
        <label for="priceOfPurchase">Price of Purchase (in euros €):</label>
        <input type="numeric" id="priceOfPurchase" name="priceOfPurchase" required><br>
        <label for="annualElectricalConsumption">Electrical Consumption (in kWh per year):</label>
        <input type="numeric" id="annualElectricalConsumption" name="annualElectricalConsumption" required><br>
        <button type="submit">Add Device</button>
    </form>

    <h2>Devices Inventory</h2>
    <button id="loadInventory">Load Inventory</button>
    <table id="inventoryTable" border="1">
        <thead>
            <tr>
                <th data-column="computerName" data-order="desc">Computer Name</th>
                <th data-column="dateOfPurchase" data-order="desc">Date of Purchase</th>
                <th data-column="priceOfPurchase" data-order="desc">Price of Purchase (€)</th>
                <th data-column="annualElectricalConsumption" data-order="desc">Annual Electrical Consumption (kWh)
                </th>
            </tr>
        </thead>
        <tbody>
            <!-- Inventory data will be inserted here -->
        </tbody>
    </table>

    <h2>Devices Inventory</h2>
    <button id="elecConsumption">Electricity Consumption</button>
    <div id="elecConsumptionMonthly"></div>
    <script>

        document.getElementById('addDeviceForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newDevice = {
                computerName: formData.get('computerName'),
                dateOfPurchase: formData.get('dateOfPurchase'),
                priceOfPurchase: parseFloat(formData.get('priceOfPurchase')),
                annualElectricalConsumption: parseFloat(formData.get('annualElectricalConsumption'))
            };
            await fetch('/api/resource', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newDevice)
            });
            event.target.reset();
            document.getElementById('loadInventory').click();
        });

        document.getElementById('elecConsumption').addEventListener('click', async () => {
            const response = await fetch('/api/consumption');
            const consumption = await response.json();
            console.log(consumption);
        });

        document.getElementById('loadInventory').addEventListener('click', async () => {
            const response = await fetch('/api/inventory');
            const inventory = await response.json();
            renderTable(inventory);
        });

        // Assumption here that the inventory is limited in size
        // For a much bigger databases (like in supply chain), handle pagination
        function renderTable(inventory) {
            const inventoryTableBody = document.getElementById('inventoryTable').getElementsByTagName('tbody')[0];
            inventoryTableBody.innerHTML = '';
            inventory.forEach(computer => {
                const row = inventoryTableBody.insertRow();
                const cellName = row.insertCell(0);
                const cellDate = row.insertCell(1);
                const cellPrice = row.insertCell(2);
                const cellConsumption = row.insertCell(3);
                cellName.textContent = computer.computerName;
                cellDate.textContent = new Date(computer.dateOfPurchase).toLocaleDateString();
                cellPrice.textContent = computer.priceOfPurchase.toString();
                cellConsumption.textContent = computer.annualElectricalConsumption.toString();
            });
        }

        document.querySelectorAll('th').forEach(header => {
            header.addEventListener('click', () => {
                const column = header.getAttribute('data-column');
                const order = header.getAttribute('data-order');
                const newOrder = order === 'desc' ? 'asc' : 'desc';
                header.setAttribute('data-order', newOrder);
                sortTable(column, newOrder);
            });
        });

        // Assumption here that the inventory is limited in size
        // For a much bigger databases (like in supply chain), optimize sorting
        // https://www.w3schools.com/js/js_array_sort.asp
        function sortTable(column, order) {
            const response = fetch('/api/inventory')
                .then(response => response.json())
                .then(inventory => {
                    const sortedInventory = inventory.sort((a, b) => {
                        if (column === 'dateOfPurchase') {
                            return order === 'asc' ? new Date(a[column]) - new Date(b[column]) : new Date(b[column]) - new Date(a[column]);
                        } else if (typeof a[column] === 'number') {
                            return order === 'asc' ? a[column] - b[column] : b[column] - a[column];
                        } else {
                            return order === 'asc' ? a[column].localeCompare(b[column]) : b[column].localeCompare(a[column]);
                        }
                    });
                    renderTable(sortedInventory);
                });
        }
    </script>
</body>

</html>